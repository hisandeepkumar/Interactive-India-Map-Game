<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>India Map Match ‚Äî Neon</title>
<style>
  :root {
    --bg: #0b0f1a;
    --panel: #101629;
    --text: #e6f0ff;
    --muted: #9ab0ff;
    --accent: #84a9ff;
    --neon1: #00e5ff;
    --neon2: #4dff91;
    --bad: #ff5e7a;
    --good: #5dffa1;
  }
  html, body {
    height: 100%;
    margin: 0;
    background: radial-gradient(1200px 800px at 70% 0%, #0f1630, var(--bg));
    color: var(--text);
    font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji';
    overflow: hidden;
  }
  .container {
    display: flex;
    flex-direction: column;
    height: 100%;
    padding: 16px;
    box-sizing: border-box;
    gap: 12px;
  }
  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 12px;
  }
  h1 {
    font-size: 20px;
    letter-spacing: 0.5px;
    margin: 0;
    text-shadow: 0 0 12px rgba(0, 229, 255, 0.4);
  }
  .hint {
    font-size: 12px; 
    opacity: 0.8; 
    color: var(--muted); 
    text-align: center;
    margin: 0;
  }
  .actions {
    display: flex; 
    gap: 8px; 
    justify-content: center;
    flex-wrap: wrap;
  }
  button {
    appearance: none;
    border: 1px solid rgba(255,255,255,0.12);
    background: linear-gradient(180deg, #1a2240, #101629);
    color: var(--text);
    padding: 10px 14px;
    border-radius: 12px;
    cursor: pointer;
    transition: transform .08s ease, box-shadow .2s ease, border-color .2s ease;
    box-shadow: 0 0 0 rgba(0, 229, 255, 0);
    font-size: 14px;
  }
  button:hover {
    transform: translateY(-1px);
    border-color: rgba(132,169,255,.8);
    box-shadow: 0 0 18px rgba(0, 229, 255, 0.25), 0 0 30px rgba(77, 255, 145, 0.15);
  }
  .pill {
    display: inline-block;
    padding: 6px 10px;
    border-radius: 999px;
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.08);
    font-size: 12px;
    margin-right: 6px;
  }
  
  /* Main merged container */
  .merged-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    position: relative;
    overflow: hidden;
    border-radius: 20px;
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    border: 1px solid rgba(255,255,255,0.08);
    box-shadow: 0 0 40px rgba(0, 229, 255, 0.06), inset 0 0 60px rgba(77, 255, 145, 0.03);
    backdrop-filter: blur(6px);
    min-height: 0;
  }
  
  /* Map area - takes available space */
  .map-area {
    flex: 1;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 15px;
    box-sizing: border-box;
    min-height: 0;
    overflow: hidden;
  }
  
  /* SVG styling */
  .map {
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  
  .map svg { 
    width: 100%;
    height: 100%;
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
  }
  
  .map path { 
    fill: #203058; 
    stroke: rgba(255,255,255,0.6); 
    stroke-width: .6; 
    transition: fill .15s linear, opacity .2s ease, filter .2s ease; 
  }
  .map path:hover { 
    filter: drop-shadow(0 0 6px rgba(0,229,255,.6)); 
  }
  .map.dimmed path { 
    opacity: .25; 
  }
  .map path.active { 
    fill: #2f4c8a; 
    opacity: 1 !important; 
  }
  .map path.correct { 
    fill: rgba(93, 255, 161, 0.3) !important; 
    stroke: rgba(93, 255, 161, 0.8) !important;
    stroke-width: 1.5;
  }
  .map path.wrong { 
    fill: rgba(255, 94, 122, 0.3) !important; 
    stroke: rgba(255, 94, 122, 0.8) !important;
    stroke-width: 1.5;
  }
  
  /* State names panel - no scroll, dynamic height */
  .state-panel {
    background: rgba(16,22,41,0.9);
    border-top: 1px solid rgba(255,255,255,0.08);
    padding: 12px 16px;
    backdrop-filter: blur(6px);
    overflow: visible;
    max-height: none;
  }
  
  .state-list-container {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    justify-content: center;
    align-items: center;
    overflow: visible;
  }
  
  .state-name {
    display: inline-flex; 
    align-items: center; 
    gap: 8px;
    padding: 8px 12px; 
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 999px;
    background: #0f1731;
    font-size: 13px;
    cursor: pointer;
    user-select: none;
    box-shadow: 0 0 0 rgba(0, 229, 255, 0);
    transition: transform .08s ease, box-shadow .2s ease, opacity .2s ease, border-color .2s ease;
    position: relative;
    /* Random neon colors will be applied via JS */
  }
  .state-name:hover { 
    transform: translateY(-1px); 
    box-shadow: 0 0 14px var(--neon-glow, rgba(0, 229, 255, 0.25)); 
  }
  .state-name.selected { 
    box-shadow: 0 0 22px var(--neon-glow, rgba(0,229,255,.45)), inset 0 0 18px rgba(77,255,145,.25); 
  }
  .state-name.removed { 
    opacity: .25; 
    pointer-events: none; 
    text-decoration: line-through; 
  }
  
  /* Neon pill style for placed states */
  .neon-pill {
    position: absolute;
    pointer-events: none;
    padding: 6px 10px;
    border-radius: 12px;
    font-size: 11px;
    border: 1px solid;
    background: rgba(10,16,32,.95);
    box-shadow: 0 0 12px;
    white-space: nowrap;
    z-index: 10;
    max-width: 120px;
    text-overflow: ellipsis;
    overflow: hidden;
    text-align: center;
    /* Neon glow effect */
    animation: neonGlow 2s infinite alternate;
  }
  
  @keyframes neonGlow {
    from {
      box-shadow: 0 0 8px;
    }
    to {
      box-shadow: 0 0 16px;
    }
  }
  
  .cursor-tag { 
    position: fixed; 
    z-index: 99; 
    pointer-events: none; 
    transform: translate(-50%, -160%);
    padding: 6px 10px; 
    border-radius: 999px; 
    border: 1px solid rgba(255,255,255,.18);
    background: rgba(11,17,35,.85); 
    box-shadow: 0 0 18px rgba(0,229,255,.35); 
    font-size: 12px; 
  }
  
  .footer-note { 
    font-size: 12px; 
    color: var(--muted); 
    text-align: center;
  }
  
  .score {
    text-align: center;
    font-size: 14px;
    margin-top: 8px;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .container {
      padding: 12px;
      gap: 10px;
    }
    .header {
      flex-direction: column;
      align-items: center;
      text-align: center;
    }
    h1 {
      font-size: 18px;
    }
    .actions {
      gap: 6px;
    }
    button {
      padding: 8px 12px;
      font-size: 13px;
    }
    .state-name {
      font-size: 12px;
      padding: 6px 10px;
    }
    .state-panel {
      padding: 10px 12px;
    }
    .map-area {
      padding: 10px;
    }
    .neon-pill {
      font-size: 10px;
      padding: 5px 8px;
      max-width: 100px;
    }
  }

  @media (max-width: 480px) {
    .container {
      padding: 8px;
      gap: 8px;
    }
    h1 {
      font-size: 16px;
    }
    .pill {
      font-size: 11px;
      padding: 4px 8px;
    }
    .state-panel {
      padding: 8px 10px;
    }
    .state-name {
      font-size: 11px;
      padding: 5px 8px;
    }
    .hint {
      font-size: 11px;
    }
    .map-area {
      padding: 8px;
    }
    .neon-pill {
      font-size: 9px;
      padding: 4px 6px;
      max-width: 80px;
    }
  }

  @media (max-width: 360px) {
    .state-name {
      font-size: 10px;
      padding: 4px 7px;
    }
    .state-list-container {
      gap: 6px;
    }
    .state-panel {
      padding: 6px 8px;
    }
    .neon-pill {
      font-size: 8px;
      padding: 3px 5px;
      max-width: 70px;
    }
  }
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üó∫Ô∏è India Map Match</h1>
      <div>
        <span class="pill" id="remainingCount">Remaining: ‚Äî</span>
        <span class="pill" id="placedCount">Placed: 0</span>
      </div>
    </div>
    
    <p class="hint">State ke naam par click karo ‚Üí phir map par sahi state me click karke naam drop karo. Sab fill hone par <b>Score Check</b> dabao.</p>
    
    <div class="actions">
      <button id="btnShuffle">Shuffle</button>
      <button id="btnReset">Reset</button>
      <button id="btnScore">Score Check</button>
    </div>
    
    <!-- Single merged container for map and names -->
    <div class="merged-container">
      <!-- Map area -->
      <div class="map-area">
        <div id="map" class="map">
          <svg
             xmlns:mapsvg="http://mapsvg.com"
             xmlns:dc="http://purl.org/dc/elements/1.1/"
             xmlns:cc="http://creativecommons.org/ns#"
             xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
             xmlns:svg="http://www.w3.org/2000/svg"
             xmlns="http://www.w3.org/2000/svg"
             version="1.1"
             id="svg2"
             viewBox="0 0 611.85999 695.70178"
             preserveAspectRatio="xMidYMid meet"
          >
            <path id="IN-AN" title="Andaman and Nicobar Islands" d="m 537.188,685.44148 -0.041,0.4695 0.768,0.30627 0.104,2.47542 1.258,1.84675 -0.71,-0.0232 0.661,0.93295 -0.574,0.18739 -0.437,0.94503 0.103,1.88201 -0.409,0.42617 -0.663,-0.49065 -0.502,1.30269 -0.461,-0.2156 0.224,-1.08911 -0.606,-0.31434 -0.121,-1.2503 -0.813,-0.73346 0.069,-0.77879 -1.076,-1.12336 -0.646,0.17933 -0.121,-1.96159 0.365,-0.27304 -0.4,-0.27001 0.64,-1.36616 0.994,0.0584 0.564,-0.57427 0.878,0.27505 0.092,-0.68006 0.86,-0.14307 z m -2.826,-4.29496 0.895,1.77017 -2.249,2.47845 -0.57,-1.39035 0.238,-1.31478 1.704,-0.4695 -0.018,-1.07399 z m -6.972,-12.28743 0.62,0.37378 0.054,0.95511 0.372,-0.12392 0.733,0.79995 -0.07,1.22108 -0.819,-0.73849 -1.384,0.38789 -0.288,-0.63372 0.323,-0.48259 -0.855,0.17027 0.198,-1.45785 1.116,-0.47151 z m 3.502,-0.0695 0.743,0.76973 -0.11,1.34098 -1.472,-1.19389 0.529,-0.85234 0.383,0.60853 -0.073,-0.67301 z m 0.656,-2.05731 0.291,1.85178 -0.652,-1.69864 0.361,-0.15314 z m -1.091,-2.2447 0.394,0.70928 -0.884,1.04981 0.947,1.26743 0.041,1.10422 -0.412,-0.27001 -0.465,0.31837 -0.158,0.77476 -0.325,-0.99943 0.426,0.0796 0.114,-0.58536 0.146,0.45237 0.247,-0.67099 -0.938,0.56621 0.092,-0.83824 -0.627,-0.64883 -0.116,-1.08809 1.518,-1.22109 z m -6.096,-0.7264 0.087,0.94704 -0.404,-0.51281 0.317,-0.43423 z m -2.282,-1.91123 0.359,0.19848 -0.356,1.48404 1.639,1.28758 -0.11,0.45942 -1.593,-0.57024 -0.756,-1.02865 0.157,-1.47599 0.66,-0.35464 z m -1.725,-2.48851 0.285,0.72439 -0.466,-0.2005 0.181,-0.52389 z m 11.976,-2.12381 0.554,2.22556 -0.33,0.0282 -0.08,0.96619 -0.144,-3.21996 z m -17.337,-14.22082 0.765,1.02563 0.632,-0.27504 -0.606,0.35464 0.105,1.13444 -0.86,0.46244 -1.209,-0.15818 -0.228,-1.89409 0.96,-0.0353 0.151,-0.86645 0.29,0.25187 z m -5.693,-35.18985 0.303,0.69114 0.034,-0.42113 0.553,0.46244 0.043,1.32486 0.571,0.30426 0.19,2.31624 -1.188,1.3984 0.616,0.72339 -1.181,1.43165 -1.64,-0.7798 -1.035,0.34255 0.738,-1.75809 -0.843,-1.12537 -0.088,-2.43411 0.448,0.45035 1.244,-2.15202 0.892,-0.62565 0.231,0.45942 0.112,-0.60853 z m 2.629,-13.08436 0.929,1.5727 -0.763,0.62868 0.924,0.42415 -0.055,0.36472 -1.862,0.51684 -0.434,-0.43927 0.123,-0.72237 0.751,-0.10478 -0.195,-1.47195 0.582,-0.76872 z m -0.926,-0.67402 -0.284,0.15415 0.186,-0.91783 0.098,0.76368 z m -7.918,-1.08407 1.085,0.17632 -0.019,1.31679 -1.158,-0.1481 0.092,-1.34501 z m 6.716,-0.23474 0.622,0.3093 -0.822,0.74252 0.2,-1.05182 z m 10.071,-5.13723 1.075,0.16624 -0.465,0.49972 -0.716,-0.34457 0.106,-0.32139 z m -1.074,-4.07532 0.271,-0.21158 0.564,0.52793 0.933,2.47844 -0.237,0.44733 -0.886,-1.45482 -0.543,0.0383 -1.023,-1.01455 0.826,-1.1556 0.095,0.34457 z m 0.412,-1.48405 0.074,1.27046 -0.647,-0.61256 -0.046,-0.72641 0.619,0.0685 z m 0.807,-1.15963 0.371,2.3918 -0.807,-0.65185 0.006,-0.67401 -1.081,-0.74958 0.615,-0.12695 0.421,0.57831 0.475,-0.76772 z m 0.855,-1.16466 0.553,1.47598 -0.427,1.26038 -0.784,-1.06593 0.658,-1.67043 z m -7.699,-0.52088 0.06,1.5052 0.968,-0.15717 -0.584,2.06436 1.288,0.63271 -0.452,0.56521 -0.476,-0.43625 -0.055,0.53498 0.673,0.36169 -1.042,0.80298 0.111,2.37769 0.468,-1.74801 0.792,-0.0836 0.084,0.74555 -0.687,4.25768 -0.257,-0.22467 -0.058,0.48561 -0.813,-0.3637 0.133,0.79189 -0.88,0.34759 0.156,0.61356 0.294,-0.32945 0.144,0.38285 0.739,-0.78081 -0.176,-0.57931 0.734,0.44632 -0.947,4.02394 -0.272,-0.63674 -1.076,-0.31937 0.008,-1.07601 -0.615,0.20452 -0.202,-1.21806 0.583,0.0897 0.174,-0.4433 -0.264,-0.31233 -0.496,0.35061 -0.418,-1.78427 -0.55,0.50173 -0.324,-3.01141 -0.489,0.20553 -0.198,-0.48058 1.023,-2.1097 0.51,1.2624 0.312,-0.20553 0.053,0.83421 0.144,-0.28009 0.264,-4.95991 1.616,-2.84819 z m 0.75,0.37277 0.37,-0.0131 -0.121,0.73346 -0.526,-0.0897 0.277,-0.6307 z m 3.455,-0.807 0.246,0.70021 -0.456,-0.22971 -0.099,0.44733 -0.164,-0.60853 0.473,-0.3093 z m 3.685,-0.13097 0.187,0.52994 0.404,-0.49267 -0.109,1.20698 -0.783,-0.54102 0.301,-0.70323 z m -2.854,-0.40401 -0.404,1.06996 -0.432,-1.22915 0.529,0.16423 0.161,-0.64379 0.146,0.63875 z m -3.45,-0.63271 1.278,0.37076 0.601,-0.27102 0.48,0.85134 -0.638,0.43221 0.453,1.08709 -0.71,-0.0554 0.088,0.85738 -0.591,-0.16523 -0.426,0.74152 0.215,0.5108 -1.001,0.93596 -0.534,-0.67401 0.644,-3.04566 -0.578,-0.18639 0.169,-0.60651 0.297,0.21459 0.359,-0.45639 -0.106,-0.54103 z m 22.254,-0.22568 0.744,0.70223 0.114,1.10321 -1.131,-0.17632 -0.248,-0.86644 0.521,-0.76268 z m -18.511,-2.01398 -0.482,1.18481 -0.272,-0.10982 0.235,-1.08406 0.519,0.009 z m -5.117,-8.89721 0.142,2.36661 -0.486,-1.68957 0.344,-0.67704 z m 3.934,-1.86588 0.482,0.0766 -0.353,0.58737 0.48,0.0252 0.547,1.64928 -0.418,0.71431 0.97,1.37624 -0.47,1.44375 0.217,3.1313 -0.76,0.34254 -0.021,0.31938 0.562,-0.0403 -0.893,0.51483 -0.017,0.81204 -1.764,-0.46949 1.351,2.31019 -1.306,0.3758 -1.274,-0.36774 -0.351,0.51584 -0.719,-0.0997 -0.439,-0.60551 0.168,-5.76087 -0.481,-0.23978 0.412,0.0141 1.029,-1.36013 -0.528,-0.48057 0.377,-0.63069 -0.465,-2.24672 0.291,0.36068 1.548,-1.94044 0.653,0.52189 0,0 0.628,-0.14911 0,0 0.544,-0.70021 z m -4.254,-1.63618 0.507,0.29217 0.034,1.9344 -0.425,1.01455 -0.541,0.11385 0.285,0.41105 -0.437,0.73447 -0.419,-1.68957 0.448,-2.16209 0.548,-0.64883 z m 6.511,-0.1078 -0.569,0.64379 0.07,0.69819 -0.646,-0.12996 0.163,-1.03974 0.261,0.42416 0.721,-0.59644 z m 0.475,-12.41236 0.326,1.0357 -0.216,1.94044 0.222,0.67603 0.337,-0.37076 0.198,0.32341 -0.326,0.51483 0.739,0.99642 -0.519,0.70726 -0.691,-0.90876 -0.617,-0.1743 -0.355,0.52692 -0.337,-0.67502 -0.412,0.35161 1.233,0.51483 0.063,0.93395 0.704,-0.11384 -0.007,0.49065 0.437,-0.28714 -0.721,2.016 0.056,2.10668 -0.648,1.12739 -0.797,-0.13904 0.185,0.47655 -0.837,-1.03369 -0.385,0.14709 -0.306,0.69517 0.771,1.08609 -0.548,0.53195 -0.113,-0.82715 -0.517,0.0494 -0.583,1.18884 0.388,0.95007 0,0 -0.628,0.14911 0,0 -1.021,-0.81909 -10e-4,-1.5314 0.505,-0.0242 0.143,-0.55815 -0.769,-0.1209 0.174,-1.53039 0.535,-0.14911 -0.256,-0.65689 0.785,-0.26396 -0.791,-0.29923 0.378,-1.79838 0.559,-0.44229 -0.669,-0.43121 0.413,-0.53196 -0.431,-0.16825 0.372,-1.40042 0.576,-0.23172 -0.5,-0.35867 0.518,0 0.343,-0.59241 -0.262,-0.89869 1.21,-0.65286 -0.25,-0.74756 0.989,-0.1743 0.506,0.35867 -0.023,-0.97626 0.467,0.67099 0.404,-0.67804 z m -0.285,-2.21549 0.251,1.06089 -1.069,-0.6055 0.818,-0.45539 z m 13.096,-26.52437 -0.617,1.4518 0.021,-0.82615 0.596,-0.62565 z" />
            <!-- Additional state paths would be added here -->
          </svg>
        </div>
      </div>
      
      <!-- State names at bottom - inside same container -->
      <div class="state-panel">
        <div class="state-list-container" id="stateList"></div>
      </div>
    </div>
    
    <div class="score" id="scoreLine"></div>
    <div class="footer-note">Neon mode ‚Ä¢ Kids friendly ‚Ä¢ India states + UTs</div>
  </div>

<script>
(function(){

  // Normalize name for comparison
  const norm = s => s.toLowerCase().replace(/&/g,'and').replace(/\s+/g,' ').replace(/[^a-z ]/g,'').trim();

  // Collect state/UT paths from SVG
  const svgEl = document.querySelector('#map svg');
  const paths = Array.from(svgEl.querySelectorAll('path[id^="IN-"]'));
  // Use title attribute for names (fallback to id)
  const regions = paths.map(p => ({ id: p.id, name: (p.getAttribute('title')||p.id).trim(), el: p }));

  // Build unique list (some maps have duplicate small islands with same title)
  const seen = new Set();
  const uniqueRegions = [];
  for (const r of regions) {
    const key = norm(r.name);
    if (!seen.has(key)) { seen.add(key); uniqueRegions.push(r); }
  }

  const stateListEl = document.getElementById('stateList');
  const remainingCount = document.getElementById('remainingCount');
  const placedCount = document.getElementById('placedCount');
  const scoreLine = document.getElementById('scoreLine');
  const btnShuffle = document.getElementById('btnShuffle');
  const btnReset = document.getElementById('btnReset');
  const btnScore = document.getElementById('btnScore');

  // Cursor tag showing the selected state following cursor
  let selectedName = null;
  let cursorTag = null;

  // placements: array of {name, regionId, correct, pillEl, color}
  const placements = [];

  // Neon colors array
  const neonColors = [
    '#00e5ff', '#4dff91', '#ff5e7a', '#ffaa00', '#bf7fff',
    '#00ffcc', '#ff4081', '#ffea00', '#40c4ff', '#76ff03',
    '#ff9100', '#e040fb', '#18ffff', '#ff4081', '#69f0ae'
  ];

  // Store color assignments for each state
  const stateColors = new Map();

  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  function getRandomNeonColor() {
    return neonColors[Math.floor(Math.random() * neonColors.length)];
  }

  function assignColorsToStates() {
    stateColors.clear();
    uniqueRegions.forEach(region => {
      stateColors.set(region.name, getRandomNeonColor());
    });
  }

  function updateCounters() {
    const remaining = Array.from(stateListEl.querySelectorAll('.state-name:not(.removed)')).length;
    remainingCount.textContent = `Remaining: ${remaining}`;
    placedCount.textContent = `Placed: ${placements.length}`;
  }

  function clearHighlights() {
    document.querySelector('#map').classList.remove('dimmed');
    paths.forEach(p => p.classList.remove('active'));
  }

  function setCursorTag(text) {
    if (!cursorTag) {
      cursorTag = document.createElement('div');
      cursorTag.className = 'cursor-tag';
      document.body.appendChild(cursorTag);
      window.addEventListener('mousemove', e => {
        if (cursorTag) {
          cursorTag.style.left = e.clientX + 'px';
          cursorTag.style.top = e.clientY + 'px';
        }
      });
    }
    cursorTag.textContent = text;
  }

  function removeCursorTag() {
    if (cursorTag) { cursorTag.remove(); cursorTag = null; }
  }

  function buildStateList() {
    stateListEl.innerHTML = '';
    const order = shuffle(uniqueRegions.slice());
    
    // Assign new colors each time we build the list
    assignColorsToStates();
    
    for (const r of order) {
      const chip = document.createElement('button');
      chip.className = 'state-name';
      chip.textContent = r.name;
      chip.dataset.name = r.name;
      
      // Apply random neon color
      const color = stateColors.get(r.name);
      chip.style.borderColor = color;
      chip.style.setProperty('--neon-glow', color + '80'); // 80 = 50% opacity
      
      chip.addEventListener('click', () => onSelectName(chip));
      stateListEl.appendChild(chip);
    }
    updateCounters();
  }

  function onSelectName(chip) {
    // Deselect others
    stateListEl.querySelectorAll('.state-name').forEach(c => c.classList.remove('selected'));
    chip.classList.add('selected');
    selectedName = chip.dataset.name;
    setCursorTag(selectedName);
    // Dim map, highlight hovered path
    document.querySelector('#map').classList.add('dimmed');
  }

  function createNeonPill(path, label, color, isCorrect) {
    // Get the centroid of the path for placing pill inside the state
    const bbox = path.getBBox();
    
    // Adjust size based on state size
    const stateSize = Math.max(bbox.width, bbox.height);
    let fontSize = 11;
    let padding = '6px 10px';
    let maxWidth = '120px';
    
    if (stateSize < 30) {
      fontSize = 8;
      padding = '3px 6px';
      maxWidth = '70px';
    } else if (stateSize < 50) {
      fontSize = 9;
      padding = '4px 7px';
      maxWidth = '90px';
    } else if (stateSize < 80) {
      fontSize = 10;
      padding = '5px 8px';
      maxWidth = '100px';
    }
    
    const x = bbox.x + bbox.width / 2;
    const y = bbox.y + bbox.height / 2;
    
    // Create neon pill
    const mapContainer = document.querySelector('.map-area');
    const pillEl = document.createElement('div');
    pillEl.className = `neon-pill ${isCorrect ? 'correct' : 'wrong'}`;
    pillEl.textContent = label;
    
    // Apply color and styles
    pillEl.style.color = color;
    pillEl.style.borderColor = color;
    pillEl.style.boxShadow = `0 0 12px ${color}`;
    pillEl.style.fontSize = fontSize + 'px';
    pillEl.style.padding = padding;
    pillEl.style.maxWidth = maxWidth;
    
    // Convert SVG coordinates to pixel coordinates
    const svg = document.querySelector('#map svg');
    const point = svg.createSVGPoint();
    point.x = x;
    point.y = y;
    const ctm = svg.getScreenCTM();
    const transformedPoint = point.matrixTransform(ctm);
    
    const mapRect = mapContainer.getBoundingClientRect();
    const left = transformedPoint.x - mapRect.left;
    const top = transformedPoint.y - mapRect.top;
    
    pillEl.style.left = left + 'px';
    pillEl.style.top = top + 'px';
    
    mapContainer.appendChild(pillEl);
    return pillEl;
  }

  function findChipByName(name) {
    return Array.from(stateListEl.querySelectorAll('.state-name')).find(c => c.dataset.name === name);
  }

  // Remove existing placement for a region
  function removePlacementForRegion(regionId) {
    const index = placements.findIndex(p => p.regionId === regionId);
    if (index !== -1) {
      // Remove the pill
      placements[index].pillEl.remove();
      // Reactivate the state name in the list
      const chip = findChipByName(placements[index].name);
      if (chip) chip.classList.remove('removed');
      // Remove from placements array
      placements.splice(index, 1);
    }
  }

  // Map interactions
  paths.forEach(p => {
    p.addEventListener('mouseenter', () => {
      if (selectedName) p.classList.add('active');
    });
    p.addEventListener('mouseleave', () => p.classList.remove('active'));

    p.addEventListener('click', e => {
      if (!selectedName) return;
      const targetRegion = uniqueRegions.find(r => r.id === p.id) || regions.find(r => r.id === p.id);
      const isCorrect = norm(selectedName) === norm(targetRegion.name);
      
      // Remove any existing placement for this region
      removePlacementForRegion(p.id);
      
      // Get the color for this state name
      const color = stateColors.get(selectedName);
      
      // Create new placement with neon pill
      const pillEl = createNeonPill(p, selectedName, color, isCorrect);

      placements.push({
        name: selectedName,
        regionId: p.id,
        correct: isCorrect,
        pillEl: pillEl,
        color: color
      });

      // Mark state name as removed in the list
      const chip = findChipByName(selectedName);
      if (chip) {
        chip.classList.add('removed');
      }
      
      selectedName = null;
      removeCursorTag();
      clearHighlights();
      updateCounters();
    });
  });

  btnShuffle.addEventListener('click', () => {
    buildStateList();
  });

  btnReset.addEventListener('click', () => {
    // reset selections and placements
    selectedName = null;
    removeCursorTag();
    clearHighlights();
    
    // Remove all pills
    placements.forEach(p => p.pillEl.remove());
    placements.splice(0, placements.length);
    
    // Reset state list
    stateListEl.querySelectorAll('.state-name').forEach(c => {
      c.classList.remove('removed','selected');
    });
    
    // Reset map styling
    paths.forEach(p => {
      p.classList.remove('correct', 'wrong');
      p.style.filter = '';
    });
    
    scoreLine.textContent = '';
    updateCounters();
  });

  btnScore.addEventListener('click', () => {
    let ok = 0, bad = 0;
    
    // Reset all path styling first
    paths.forEach(p => {
      p.classList.remove('correct', 'wrong');
      p.style.filter = '';
    });
    
    // Apply correct/wrong styling to paths
    placements.forEach(pl => {
      const path = document.getElementById(pl.regionId);
      
      if (path) {
        if (pl.correct) { 
          ok++; 
          path.classList.add('correct');
        } else { 
          bad++; 
          path.classList.add('wrong');
        }
      }
    });
    
    scoreLine.innerHTML = `‚úÖ Correct: <b>${ok}</b> &nbsp; | &nbsp; ‚ùå Incorrect: <b>${bad}</b>`;
  });

  // Initial render
  buildStateList();

})();
</script>
</body>
</html>
